<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>HeapOverride Senpai's Castle | 0xlilith</title><meta name=keywords content="writeup,rev"><meta name=description content="Lilith Struggling with heap senpai's binary"><meta name=author content="lilith"><link rel=canonical href=/posts/heapoverride-senpais-castle/><link crossorigin=anonymous href=/assets/css/stylesheet.min.a07280dcb1362f46112ef52643b657ea17a35bdda7e7a4ee6bd5ddc37d5e8715.css integrity="sha256-oHKA3LE2L0YRLvUmQ7ZX6hejW92n56Tua9Xdw31ehxU=" rel="preload stylesheet" as=style><link rel=icon href=favicon.ico><link rel=apple-touch-icon href=apple-touch-icon.png><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta name=twitter:card content="summary"><meta name=twitter:title content="HeapOverride Senpai's Castle | 0xlilith"><meta name=twitter:description content="Lilith Struggling with heap senpai's binary"><meta property="og:title" content="HeapOverride Senpai's Castle | 0xlilith"><meta property="og:description" content="Lilith Struggling with heap senpai's binary"><meta property="og:type" content="article"><meta property="og:url" content="/posts/heapoverride-senpais-castle/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-07T00:00:00+00:00"><meta property="article:modified_time" content="2021-08-07T00:00:00+00:00"><meta property="og:site_name" content="0xlilith"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"HeapOverride Senpai's Castle","item":"/posts/heapoverride-senpais-castle/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"HeapOverride Senpai's Castle | 0xlilith","name":"HeapOverride Senpai\u0027s Castle","description":"Lilith Struggling with heap senpai's binary","keywords":["writeup","rev"],"wordCount":"394","inLanguage":"en","datePublished":"2021-08-07T00:00:00Z","dateModified":"2021-08-07T00:00:00Z","author":{"@type":"Person","name":"lilith"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/heapoverride-senpais-castle/"},"publisher":{"@type":"Organization","name":"0xlilith","logo":{"@type":"ImageObject","url":"favicon.ico"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class="dark type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="dark",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="0xlilith (Alt + H)">0xlilith</a>
<span class=logo-switches></span></div><ul id=menu><li><a href=/posts/ title=posts class=active>posts</a></li><li><a href=/tags/ title=tags>tags</a></li><li><a href=/archives/ title=archives>archives</a></li><li><a href=https://0xlilith.github.io/exploits/ title=exploits>exploits</a></li></ul></nav><hr style="border:1.6px dashed #843f48"></hr></header><main class="main post"><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;Â»&nbsp;<a href=/posts/>Posts</a></div><h1 class=post-title>HeapOverride Senpai's Castle</h1><div class=post-description>Lilith Struggling with heap senpai's binary</div><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>August 7, 2021</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=/tags/writeup/>writeup</a><a href=/tags/rev/>rev</a></span></span></div></header><div class=post-content><p><img loading=lazy src=/images/img1.png type alt></p><p>hmmm smol pp moment ! now we go open it in a disassembler</p><p><img loading=lazy src=/images/img2.png type alt></p><p>lets read the main function!
first it does its regular job of loading the stack and moving argc and argv to the registers
then it checks weither the value of argc is == 2 as it takes one 1 argument vector shown in img1.
If it fails the condition then it jumps to the address 0x11bd. less have a look at it.</p><p><img loading=lazy src=/images/img3.png type alt></p><p>brrr&mldr;.as we can see it just prints out the string &ldquo;Umm&mldr;no&mldr;&rdquo;
now lets see what happens if it matches the condition i.e if we pass something in the argument vector.</p><p><img loading=lazy src=/images/img4.png type alt></p><p>okkkkkkkk wait i am feeling cold&mldr; i am back. Back to the whatever we are doing. We can see that the string
that we entered is being passed to a function call fun.00011dc. Now lets see what that function does to our
baby stringwqnwdn. uhhghhghg my string ;-;-;-;!!</p><p><img loading=lazy src=/images/img5.png type alt></p><p>brrrr this shit is too confusing lets decompile it else ill die trying
you dont want me to die right?&mldr;.right? do you want me to die do you want me to DIE???
ok</p><p><img loading=lazy src=/images/img6.png type alt></p><p>much better but we still need to do some cleanups&mldr;wait here
I just changed the variable names to something readable brrr wtf is uVar3 and var4h._4_4</p><p><img loading=lazy src=/images/img7.png type alt></p><p>before we do anything else lets first see what that 0x4050 holds for us.
shshbh &ldquo;FZGSVdzohWNAAGSCW^z_HMf]THbJWUnT_URK&rdquo; som crazy string.
They are first comparing the length of that crazy string to the length of our baby string.
And if the condition matches we enter inside the loop.</p><p>lets make it moe simple [note: asuming crazy = 0x4050]</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=mi>13</span>  <span class=n>j</span> <span class=o>=</span> <span class=n>crazy_string_len</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=mi>14</span>  <span class=k>for</span><span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>crazy_string_len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl><span class=mi>15</span>    <span class=k>if</span> <span class=p>(</span><span class=n>crazy</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>j</span> <span class=o>^</span> <span class=mi>55</span> <span class=p>)</span> <span class=o>!=</span> 
</span></span><span class=line><span class=cl><span class=mi>16</span>      <span class=n>arg1</span><span class=p>[</span><span class=n>i</span><span class=p>]){</span> <span class=c1>// this next line is on purpose cus i am trying to replicate the code line by line
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>17</span>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=mi>18</span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=mi>19</span>    <span class=n>j</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=mi>20</span>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>j stores the length of that crazy string. Then inside the for loop we have an if with some condition.
char at index i of crazy xor j xor 55 is != char at index i of our baby string.
waaaaaaw now we know whats actually happening inside the hood. We can just write a script to solve it</p><p><img loading=lazy src=/images/img8.png type alt></p><p>hmmm BIG pp moment !! we got the flag</p></div><footer class=post-footer><nav class=paginav><a class=prev href=/posts/jhaddix-methodology-v4/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>JHaddix Methodology V4</span></a></nav></footer></article></main></body></html>